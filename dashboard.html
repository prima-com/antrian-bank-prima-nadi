<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard Operator Enterprise PRO</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
font-family:Arial;
background:#0e2f5a;
color:white;
text-align:center;
margin:0;
padding:20px;
}
button{
padding:12px 20px;
margin:5px;
font-size:16px;
border:none;
border-radius:6px;
cursor:pointer;
background:#FFD700;
font-weight:bold;
}
button:hover{opacity:0.8;}
.loginBox{
position:fixed;
inset:0;
background:#0e2f5a;
display:flex;
justify-content:center;
align-items:center;
z-index:9999;
}
.loginContent{
background:white;
padding:30px;
border-radius:10px;
width:300px;
text-align:center;
color:black;
}
</style>
</head>
<body>

<div class="loginBox" id="loginBox">
<div class="loginContent">
<h3>Login Operator</h3>
<input type="text" id="username" placeholder="Username" style="width:100%;padding:10px;margin-bottom:10px;">
<input type="password" id="password" placeholder="Password" style="width:100%;padding:10px;margin-bottom:10px;">
<button onclick="login()">Masuk</button>
</div>
</div>

<h1>DASHBOARD OPERATOR</h1>
<div id="operatorInfo"></div>

<div>
<button onclick="panggil('loket1')">Panggil Loket 1</button>
<button onclick="ulang('loket1')">Ulang Loket 1</button><br>

<button onclick="panggil('loket2')">Panggil Loket 2</button>
<button onclick="ulang('loket2')">Ulang Loket 2</button><br>

<button onclick="panggil('loket3')">Panggil Loket 3</button>
<button onclick="ulang('loket3')">Ulang Loket 3</button><br>

<button onclick="panggil('loket4')">Panggil Loket 4</button>
<button onclick="ulang('loket4')">Ulang Loket 4</button>
</div>

<script>

var firebaseConfig = {
apiKey: "AIzaSyB7f2r5KbTkk-14bc5cXNHEVlV5J1WfMf8",
authDomain: "antrian-bank-prima-nadi.firebaseapp.com",
databaseURL: "https://antrian-bank-prima-nadi-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId: "antrian-bank-prima-nadi"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

let role=null;
let prefix="";
let allowedLoket=[];
let lastNomor={};

function login(){
const username=document.getElementById("username").value;
const password=document.getElementById("password").value;

db.ref("users/"+username).once("value",snap=>{
if(!snap.exists()){alert("User tidak ditemukan");return;}
const data=snap.val();
if(data.password!==password){alert("Password salah");return;}
role=data.role;
document.getElementById("loginBox").style.display="none";
initRole();
});
}

function initRole(){
if(role==="cs"){
prefix="A";
allowedLoket=["loket1","loket2"];
}else{
prefix="B";
allowedLoket=["loket3","loket4"];
}
document.getElementById("operatorInfo").innerHTML=
"<h3>Login sebagai: "+role.toUpperCase()+"</h3>";
hideUnauthorized();
}

function hideUnauthorized(){
document.querySelectorAll("button").forEach(btn=>{
const oc=btn.getAttribute("onclick");
if(oc){
const match=oc.match(/'(loket\d+)'/);
if(match){
if(!allowedLoket.includes(match[1])){
btn.style.display="none";
}
}
}
});
}

function panggil(loket){
if(!allowedLoket.includes(loket)) return;

let prefixLoket = (loket==="loket1"||loket==="loket2")?"A":"B";

db.ref("queue/"+prefixLoket)
.orderByChild("status")
.equalTo("waiting")
.limitToFirst(1)
.once("value",snap=>{

if(!snap.exists()){
alert("Tidak ada antrian");
return;
}

let key=Object.keys(snap.val())[0];
let data=snap.val()[key];

lastNomor[loket]=data.nomor;

db.ref("queue/"+prefixLoket+"/"+key).update({
status:"called"
});

db.ref("loket/"+loket).set({
nomor:data.nomor,
waktu:Date.now()
});

});
}

function ulang(loket){
if(!lastNomor[loket]) return;
db.ref("loket/"+loket).set({
nomor:lastNomor[loket],
waktu:Date.now()
});
}

</script>
</body>
</html>











