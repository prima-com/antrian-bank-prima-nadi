<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Operator</title>

<style>

body{
font-family:Arial;
text-align:center;
background:#f2f2f2;
}

button{
padding:15px 25px;
margin:8px;
font-size:18px;
border:none;
border-radius:8px;
cursor:pointer;
}

.panggil{
background:#28a745;
color:white;
}

.ulang{
background:#ffc107;
}

.box{
background:white;
padding:20px;
border-radius:10px;
display:inline-block;
margin:10px;
}

.nomor{
font-size:32px;
font-weight:bold;
}

</style>

</head>
<body>


<h2>DASHBOARD OPERATOR</h2>


<div class="box">

<h3>Loket 1 (CS)</h3>

<div id="loket1" class="nomor">-</div>

<button class="panggil"
onclick="panggil('cs','loket1','A')">
PANGGIL
</button>

<button class="ulang"
onclick="ulang('loket1')">
ULANG
</button>

</div>



<div class="box">

<h3>Loket 2 (TELLER)</h3>

<div id="loket2" class="nomor">-</div>

<button class="panggil"
onclick="panggil('teller','loket2','B')">
PANGGIL
</button>

<button class="ulang"
onclick="ulang('loket2')">
ULANG
</button>

</div>



<div class="box">

<h3>Loket 3 (TELLER)</h3>

<div id="loket3" class="nomor">-</div>

<button class="panggil"
onclick="panggil('teller','loket3','B')">
PANGGIL
</button>

<button class="ulang"
onclick="ulang('loket3')">
ULANG
</button>

</div>



<div class="box">

<h3>Loket 4 (TELLER)</h3>

<div id="loket4" class="nomor">-</div>

<button class="panggil"
onclick="panggil('teller','loket4','B')">
PANGGIL
</button>

<button class="ulang"
onclick="ulang('loket4')">
ULANG
</button>

</div>



<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>


<script>


// ==========================
// CONFIG FIREBASE
// ==========================
const firebaseConfig = {

apiKey: "AIzaSyB7f2r5KbTkk-14bc5cXNHEVlV5J1WfMf8",

authDomain: "antrian-bank-prima-nadi.firebaseapp.com",

databaseURL:
"https://antrian-bank-prima-nadi-default-rtdb.asia-southeast1.firebasedatabase.app",

projectId: "antrian-bank-prima-nadi",

storageBucket:
"antrian-bank-prima-nadi.firebasestorage.app",

messagingSenderId: "807742809953",

appId:
"1:807742809953:web:afeb350b36f4731d36c720"

};


firebase.initializeApp(firebaseConfig);

const db = firebase.database();



// ==========================
// UNLOCK AUDIO
// ==========================
document.body.addEventListener("click",function(){

speechSynthesis.resume();

});



// ==========================
// ENGINE SUARA STABIL
// ==========================
function speak(teks){

speechSynthesis.cancel();

setTimeout(()=>{

const msg =
new SpeechSynthesisUtterance(teks);

msg.lang="id-ID";

msg.rate=0.9;

msg.pitch=1;

msg.volume=1;

speechSynthesis.speak(msg);

},100);

}



// ==========================
// FORMAT SUARA
// ==========================
function panggilSuara(nomor,loket){

const noBaca =
nomor.replace(/^([A-Z])0+/,"$1 ");

const teks =
"Nomor antrian "+
noBaca.split("").join(" ")+
" silakan menuju "+
loket.replace("loket","loket ");

speak(teks);

}



// ==========================
// PANGGIL NOMOR BARU
// ==========================
function panggil(type,loket,kode){

const ref =
db.ref("antrian/"+type+"/current");


ref.once("value").then(snapshot=>{

let nomor =
snapshot.val() || 0;

nomor++;

ref.set(nomor);


const tampil =
kode +
nomor.toString().padStart(3,"0");


// kirim ke firebase
db.ref("loket/"+loket).set(tampil);


// bunyi di dashboard
panggilSuara(tampil,loket);


});

}



// ==========================
// ULANG PANGGILAN
// ==========================
function ulang(loket){

db.ref("loket/"+loket).once("value")
.then(snapshot=>{

let nomor=snapshot.val();

if(!nomor || nomor=="-"){

alert("Belum ada nomor dipanggil");

return;

}


// trigger ulang agar TV bunyi
db.ref("loket/"+loket).set(null);

setTimeout(()=>{

db.ref("loket/"+loket).set(nomor);

},100);


// bunyi dashboard
panggilSuara(nomor,loket);


});

}



// ==========================
// LISTENER REALTIME DISPLAY
// ==========================
["loket1","loket2","loket3","loket4"]
.forEach(id=>{

db.ref("loket/"+id)
.on("value",(snap)=>{

document.getElementById(id)
.innerText=snap.val() || "-";

});

});


</script>


</body>
</html>






