<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Operator</title>

<style>
body{
  font-family:Arial;
  background:#0b2a4a;
  color:white;
  text-align:center;
}

.loket{
  background:#123c6b;
  margin:15px;
  padding:20px;
  border-radius:10px;
}

button{
  padding:10px 15px;
  margin:5px;
  font-size:16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.panggil{background:#28a745;color:white;}
.ulang{background:#ffc107;color:black;}
</style>
</head>

<body>

<h1>DASHBOARD OPERATOR</h1>

<div class="loket">
<h2>Loket 1</h2>
<h1 id="last_loket1">-</h1>
<button class="panggil" onclick="panggil('loket1')">PANGGIL</button>
<button class="ulang" onclick="ulang('loket1')">ULANG</button>
</div>

<div class="loket">
<h2>Loket 2</h2>
<h1 id="last_loket2">-</h1>
<button class="panggil" onclick="panggil('loket2')">PANGGIL</button>
<button class="ulang" onclick="ulang('loket2')">ULANG</button>
</div>

<div class="loket">
<h2>Loket 3</h2>
<h1 id="last_loket3">-</h1>
<button class="panggil" onclick="panggil('loket3')">PANGGIL</button>
<button class="ulang" onclick="ulang('loket3')">ULANG</button>
</div>

<div class="loket">
<h2>Loket 4</h2>
<h1 id="last_loket4">-</h1>
<button class="panggil" onclick="panggil('loket4')">PANGGIL</button>
<button class="ulang" onclick="ulang('loket4')">ULANG</button>
</div>


<script type="module">
import { db } from "./firebase-config.js";
import { ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* ========================
   LISTEN LAST NOMOR
======================== */
function listenLoket(id){
  onValue(ref(db,"loket/"+id),(snap)=>{
    const val=snap.val()||"-";
    document.getElementById("last_"+id).innerText=val;
  });
}

listenLoket("loket1");
listenLoket("loket2");
listenLoket("loket3");
listenLoket("loket4");


/* ========================
   PANGGIL NOMOR
======================== */
window.panggil = function(loket){

  let prefix="A";
  if(loket=="loket2") prefix="B";
  if(loket=="loket3") prefix="C";
  if(loket=="loket4") prefix="D";

  const counterRef = ref(db,"counter/"+prefix);

  onValue(counterRef,(snap)=>{
    let nomor=snap.val()||0;
    nomor++;

    set(counterRef, nomor);

    const nomorFix = prefix + nomor.toString().padStart(3,"0");

    set(ref(db,"loket/"+loket), nomorFix);

  },{onlyOnce:true});
};


/* ========================
   ULANG PANGGILAN
======================== */
window.ulang = function(loket){

  const nomor = document.getElementById("last_"+loket).innerText;

  if(nomor=="-") return;

  set(ref(db,"ulang/"+loket), nomor);
};

</script>

</body>
</html>






