<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Operator</title>

<style>
body{font-family:Arial;text-align:center;background:#f2f2f2}
button{padding:15px 25px;margin:8px;font-size:18px;border:none;border-radius:8px;cursor:pointer}
.panggil{background:#28a745;color:white}
.ulang{background:#ffc107}
.box{background:white;padding:20px;border-radius:10px;display:inline-block;margin:10px}
.nomor{font-size:32px;font-weight:bold}
</style>
</head>

<body>

<h2>DASHBOARD OPERATOR</h2>

<div class="box">
<h3>Loket 1</h3>
<div id="loket1" class="nomor">-</div>
<button class="panggil" onclick="panggil('cs','loket1','A')">PANGGIL</button>
<button class="ulang" onclick="ulang('loket1')">ULANG</button>
</div>

<div class="box">
<h3>Loket 2</h3>
<div id="loket2" class="nomor">-</div>
<button class="panggil" onclick="panggil('teller','loket2','B')">PANGGIL</button>
<button class="ulang" onclick="ulang('loket2')">ULANG</button>
</div>

<div class="box">
<h3>Loket 3</h3>
<div id="loket3" class="nomor">-</div>
<button class="panggil" onclick="panggil('teller','loket3','B')">PANGGIL</button>
<button class="ulang" onclick="ulang('loket3')">ULANG</button>
</div>

<div class="box">
<h3>Loket 4</h3>
<div id="loket4" class="nomor">-</div>
<button class="panggil" onclick="panggil('teller','loket4','B')">PANGGIL</button>
<button class="ulang" onclick="ulang('loket4')">ULANG</button>
</div>


<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
apiKey: "AIzaSyB7f2r5KbTkk-14bc5cXNHEVlV5J1WfMf8",
authDomain: "antrian-bank-prima-nadi.firebaseapp.com",
databaseURL: "https://antrian-bank-prima-nadi-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId: "antrian-bank-prima-nadi"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function speak(teks){
    speechSynthesis.cancel();
    const msg = new SpeechSynthesisUtterance(teks);
    msg.lang = "id-ID";
    msg.rate = 0.9;
    speechSynthesis.speak(msg);
}

function panggil(type,loket,kode){

    const ref = db.ref("antrian/"+type+"/current");

    ref.once("value").then(snapshot => {

        let nomor = snapshot.val() || 0;
        nomor++;

        ref.set(nomor);

        const tampil = kode + nomor.toString().padStart(3,"0");

        db.ref("loket/"+loket).set(tampil);
    });
}

function ulang(loket){

    db.ref("loket/"+loket).once("value").then(snapshot => {

        let nomor = snapshot.val();
        if(!nomor) return;

        const noBaca = nomor.replace(/^([A-Z])0+/, "$1 ");

        speak("Nomor antrian " + noBaca.split("").join(" ") +
              " silakan menuju " + loket.replace("loket","loket "));
    });
}

["loket1","loket2","loket3","loket4"].forEach(id=>{

    db.ref("loket/"+id).on("value", snap => {

        let nomor = snap.val();
        document.getElementById(id).innerText = nomor || "-";

        if(nomor){
            const noBaca = nomor.replace(/^([A-Z])0+/, "$1 ");
            speak("Nomor antrian " + noBaca.split("").join(" ") +
                  " silakan menuju " + id.replace("loket","loket "));
        }

    });

});
</script>

</body>
</html>





