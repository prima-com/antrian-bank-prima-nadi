<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Operator</title>

<style>
body{
  margin:0;
  font-family:Poppins;
  background:linear-gradient(135deg,#0b2d57,#1b5fc1);
  color:white;
}

.header{
  padding:20px;
  text-align:center;
  font-size:28px;
  background:#0a2445;
}

.container{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:25px;
  padding:30px;
}

.card{
  background:#163d6b;
  border-radius:20px;
  padding:25px;
  text-align:center;
}

.nomor{
  font-size:70px;
  color:gold;
  margin:20px 0;
}

button{
  padding:12px 20px;
  font-size:16px;
  margin:5px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}

.call{ background:gold; }
.repeat{ background:#00c853; color:white; }
</style>
</head>

<body>

<div class="header">DASHBOARD OPERATOR</div>

<div class="container">

<div class="card">
<h3>LOKET 1</h3>
<div id="loket1" class="nomor">-</div>
<button class="call" onclick="panggil('teller','loket1','A')">PANGGIL</button>
<button class="repeat" onclick="ulang('loket1')">ULANG</button>
</div>

<div class="card">
<h3>LOKET 2</h3>
<div id="loket2" class="nomor">-</div>
<button class="call" onclick="panggil('teller','loket2','A')">PANGGIL</button>
<button class="repeat" onclick="ulang('loket2')">ULANG</button>
</div>

<div class="card">
<h3>LOKET 3</h3>
<div id="loket3" class="nomor">-</div>
<button class="call" onclick="panggil('cs','loket3','B')">PANGGIL</button>
<button class="repeat" onclick="ulang('loket3')">ULANG</button>
</div>

<div class="card">
<h3>LOKET 4</h3>
<div id="loket4" class="nomor">-</div>
<button class="call" onclick="panggil('cs','loket4','B')">PANGGIL</button>
<button class="repeat" onclick="ulang('loket4')">ULANG</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB7f2r5KbTkk-14bc5cXNHEVlV5J1WfMf8",
  authDomain: "antrian-bank-prima-nadi.firebaseapp.com",
  databaseURL: "https://antrian-bank-prima-nadi-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "antrian-bank-prima-nadi",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

function speak(text){
  let msg = new SpeechSynthesisUtterance(text);
  msg.lang="id-ID";
  speechSynthesis.speak(msg);
}

window.panggil = async function(type,loket,kode){

  const snap = await get(ref(db,'antrian/'+type+'/current'));
  let nomor = snap.val() || 0;
  nomor++;

  await update(ref(db,'antrian/'+type),{
    current: nomor,
    last: nomor
  });

  const tampil = kode + nomor.toString().padStart(3,"0");

  await update(ref(db,'loket'),{
    [loket]: tampil
  });

  speak("Nomor "+tampil+" silakan ke "+loket.replace("loket","loket "));
}

window.ulang = function(loket){
  speak("Nomor "+document.getElementById(loket).innerText);
}

/* REALTIME LISTENER */
['loket1','loket2','loket3','loket4'].forEach(id=>{
  onValue(ref(db,'loket/'+id),(snap)=>{
    if(snap.exists()){
      document.getElementById(id).innerText = snap.val();
    }
  });
});

</script>

</body>
</html>
