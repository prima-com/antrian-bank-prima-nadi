<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard Operator</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
font-family:Arial;
background:#0e2f5a;
color:white;
text-align:center;
margin:0;
padding:20px;
}

h1{
margin-bottom:20px;
}

button{
padding:12px 20px;
margin:5px;
font-size:16px;
border:none;
border-radius:6px;
cursor:pointer;
background:#FFD700;
font-weight:bold;
}

button:hover{
opacity:0.8;
}

.panel{
margin-top:20px;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox" style="position:fixed;inset:0;background:#0e2f5a;display:flex;justify-content:center;align-items:center;z-index:9999;">
  <div style="background:white;padding:30px;border-radius:10px;width:300px;text-align:center;color:black;">
    <h3>Login Operator</h3>
    <input type="password" id="password" placeholder="Masukkan Password" style="width:100%;padding:10px;margin-bottom:10px;">
    <button onclick="login()">Masuk</button>
  </div>
</div>

<h1>DASHBOARD OPERATOR</h1>

<div class="panel">
<button onclick="panggil('loket1')">Panggil Loket 1</button>
<button onclick="ulang('loket1')">Ulang Loket 1</button><br>

<button onclick="panggil('loket2')">Panggil Loket 2</button>
<button onclick="ulang('loket2')">Ulang Loket 2</button><br>

<button onclick="panggil('loket3')">Panggil Loket 3</button>
<button onclick="ulang('loket3')">Ulang Loket 3</button><br>

<button onclick="panggil('loket4')">Panggil Loket 4</button>
<button onclick="ulang('loket4')">Ulang Loket 4</button>
</div>

<script>
// ================= FIREBASE =================
var firebaseConfig = {
apiKey: "ISI_API_KEY",
authDomain: "ISI_AUTH_DOMAIN",
databaseURL: "ISI_DATABASE_URL",
projectId: "ISI_PROJECT_ID",
storageBucket: "ISI_STORAGE",
messagingSenderId: "ISI_SENDER",
appId: "ISI_APP_ID"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

// ================= LOGIN SYSTEM =================
const users = {
"cs123":"cs",
"teller123":"teller"
};

let role=null;
let prefix="";
let allowedLoket=[];
let counter=1;
let lastNomor={};

function login(){
const pass=document.getElementById("password").value;
if(users[pass]){
role=users[pass];
document.getElementById("loginBox").style.display="none";
initRole();
}else{
alert("Password salah!");
}
}

function initRole(){
if(role==="cs"){
prefix="A";
allowedLoket=["loket1","loket2"];
}else{
prefix="B";
allowedLoket=["loket3","loket4"];
}
hideUnauthorized();
resetIfNewDay();
}

// ================= BATASI LOKET =================
function hideUnauthorized(){
document.querySelectorAll("button").forEach(btn=>{
const oc=btn.getAttribute("onclick");
if(oc){
const match=oc.match(/'(loket\d+)'/);
if(match){
if(!allowedLoket.includes(match[1])){
btn.style.display="none";
}
}
}
});
}

// ================= RESET HARIAN =================
function resetIfNewDay(){
const today=new Date().toISOString().slice(0,10);
const lastDate=localStorage.getItem("lastDate");

if(lastDate!==today){
localStorage.setItem("counterA",1);
localStorage.setItem("counterB",1);
localStorage.setItem("lastDate",today);
}

counter=parseInt(localStorage.getItem("counter"+prefix))||1;
}

// ================= GENERATE NOMOR =================
function generateNomor(){
const nomor=prefix+String(counter).padStart(3,"0");
localStorage.setItem("counter"+prefix,counter+1);
counter++;
return nomor;
}

// ================= PANGGIL =================
function panggil(loket){
if(!allowedLoket.includes(loket)) return;

const nomor=generateNomor();
lastNomor[loket]=nomor;

db.ref("loket/"+loket).set({
nomor:nomor,
waktu:Date.now()
});

updateStat();
}

// ================= ULANG =================
function ulang(loket){
if(!allowedLoket.includes(loket)) return;
if(!lastNomor[loket]) return;

db.ref("loket/"+loket).set({
nomor:lastNomor[loket],
waktu:Date.now()
});
}

// ================= STATISTIK =================
function updateStat(){
const key="stat_"+role;
let stat=parseInt(localStorage.getItem(key))||0;
stat++;
localStorage.setItem(key,stat);
console.log("Total panggilan "+role+" hari ini:",stat);
}
</script>

</body>
</html>









