<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Operator - Bank Prima Nadi</title>

<style>
body{
  margin:0;
  font-family:Poppins,Arial;
  background:linear-gradient(135deg,#0b2d57,#1b5fc1);
  color:white;
}

/* HEADER */
.header{
  background:#0a2445;
  padding:20px;
  text-align:center;
  font-size:28px;
  font-weight:bold;
  letter-spacing:2px;
}

/* GRID */
.container{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:25px;
  padding:30px;
}

/* CARD */
.card{
  background:#163d6b;
  border-radius:20px;
  padding:25px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
}

.title{
  font-size:24px;
  margin-bottom:10px;
}

.nomor{
  font-size:70px;
  color:gold;
  font-weight:bold;
  margin:20px 0;
}

/* BUTTON */
.btn{
  padding:15px 25px;
  border:none;
  border-radius:10px;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
  margin:5px;
}

.call{ background:gold; color:black; }
.repeat{ background:#00c853; color:white; }
.skip{ background:#ff5252; color:white; }

.btn:hover{ transform:scale(1.05); }
</style>
</head>

<body>

<div class="header">DASHBOARD OPERATOR ANTRIAN</div>

<div class="container">

<!-- LOKET 1 -->
<div class="card">
  <div class="title">LOKET 1 - TELLER</div>
  <div id="loket1" class="nomor">-</div>
  <button class="btn call" onclick="panggil('teller','loket1','A')">PANGGIL</button>
  <button class="btn repeat" onclick="ulang('loket1')">ULANG</button>
</div>

<!-- LOKET 2 -->
<div class="card">
  <div class="title">LOKET 2 - TELLER</div>
  <div id="loket2" class="nomor">-</div>
  <button class="btn call" onclick="panggil('teller','loket2','A')">PANGGIL</button>
  <button class="btn repeat" onclick="ulang('loket2')">ULANG</button>
</div>

<!-- LOKET 3 -->
<div class="card">
  <div class="title">LOKET 3 - CS</div>
  <div id="loket3" class="nomor">-</div>
  <button class="btn call" onclick="panggil('cs','loket3','B')">PANGGIL</button>
  <button class="btn repeat" onclick="ulang('loket3')">ULANG</button>
</div>

<!-- LOKET 4 -->
<div class="card">
  <div class="title">LOKET 4 - CS</div>
  <div id="loket4" class="nomor">-</div>
  <button class="btn call" onclick="panggil('cs','loket4','B')">PANGGIL</button>
  <button class="btn repeat" onclick="ulang('loket4')">ULANG</button>
</div>

</div>

<!-- FIREBASE -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* CONFIG FIREBASE BOSQUE */
const firebaseConfig = {
  apiKey: "AIzaSyB7f2r5KbTkk-14bc5cXNHEVlV5J1WfMf8",
  authDomain: "antrian-bank-prima-nadi.firebaseapp.com",
  databaseURL: "https://antrian-bank-prima-nadi-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "antrian-bank-prima-nadi",
  storageBucket: "antrian-bank-prima-nadi.firebasestorage.app",
  messagingSenderId: "807742809953",
  appId: "1:807742809953:web:afeb350b36f4731d36c720"
};

/* INIT */
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* SUARA */
function speak(text){
  let msg = new SpeechSynthesisUtterance(text);
  msg.lang="id-ID";
  speechSynthesis.speak(msg);
}

/* PANGGIL */
window.panggil = async function(type,loket,kode){

  const snap = await get(ref(db,'antrian/'+type+'/current'));
  let nomor = snap.val() || 0;
  nomor++;

  await update(ref(db,'antrian/'+type),{ current: nomor });

  const tampil = kode + nomor.toString().padStart(3,"0");

  await update(ref(db,'loket'),{ [loket]: tampil });

  speak("Nomor "+tampil+" silakan ke "+loket.replace("loket","loket "));
}

/* ULANG */
window.ulang = function(loket){
  const el = document.getElementById(loket);
  speak("Nomor "+el.innerText+" silakan ke "+loket.replace("loket","loket "));
}

/* REALTIME DISPLAY */
['loket1','loket2','loket3','loket4'].forEach(id=>{
  onValue(ref(db,'loket/'+id),(snap)=>{
    if(snap.exists()){
      document.getElementById(id).innerText = snap.val();
    }
  });
});

</script>


</body>
</html>


