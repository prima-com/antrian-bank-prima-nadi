<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard Loket - Bank Prima Nadi</title>

<style>
body{
  margin:0;
  font-family:Segoe UI;
  background:#f4f6f9;
  text-align:center;
  padding:40px;
}

.card{
  background:white;
  padding:40px;
  border-radius:15px;
  width:450px;
  margin:auto;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
}

h2{
  margin-bottom:20px;
  color:#1e3c72;
}

select{
  padding:10px;
  border-radius:8px;
  margin-bottom:20px;
  width:100%;
}

button{
  padding:12px 20px;
  border:none;
  border-radius:8px;
  background:#1e3c72;
  color:white;
  cursor:pointer;
  width:100%;
  margin-top:10px;
  font-size:15px;
}

button:hover{
  background:#16315c;
}

#nomorSekarang{
  font-size:22px;
  font-weight:bold;
  margin:20px 0;
  color:#2a5298;
}

.logout{
  background:#999;
}

.logout:hover{
  background:#777;
}
</style>
</head>

<body>

<div class="card">
  <h2>Dashboard Loket</h2>

  <select id="jenis">
    <option value="teller">Teller</option>
    <option value="cs">Customer Service</option>
  </select>

  <div id="nomorSekarang">Belum ada panggilan</div>

  <button onclick="panggil()">Panggil Nomor Berikutnya</button>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<script type="module">

// ðŸ”¥ GANTI DENGAN CONFIG BOSQUE
const firebaseConfig = {
  apiKey: "AIzaSyB7f2r5KbTkk-14bc5cXNHEVlV5J1WfMf8",
  authDomain: "antrian-bank-prima-nadi.firebaseapp.com",
  databaseURL: "https://antrian-bank-prima-nadi-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "antrian-bank-prima-nadi",
  storageBucket: "antrian-bank-prima-nadi.firebasestorage.app",
  messagingSenderId: "807742809953",
  appId: "1:807742809953:web:afeb350b36f4731d36c720"
};

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import { getDatabase, ref, get, update }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// ðŸ” Proteksi Login
onAuthStateChanged(auth,(user)=>{
  if(!user){
    window.location.href="login.html";
  }
});

// ðŸ”Š Fungsi Panggil
window.panggil = async function(){

  const jenis = document.getElementById("jenis").value;

  const currentRef = ref(db,"antrian/"+jenis+"/current");
  const lastRef = ref(db,"antrian/"+jenis+"/lastCalled");

  const snapCurrent = await get(currentRef);
  const snapLast = await get(lastRef);

  let current = snapCurrent.val() || 0;
  let last = snapLast.val() || 0;

  if(last >= current){
    alert("Tidak ada antrian baru");
    return;
  }

  last++;

  await update(ref(db,"antrian/"+jenis),{
    lastCalled: last
  });

  let prefix = jenis === "teller" ? "A" : "B";
  let formatted = prefix + last.toString().padStart(3,"0");

  document.getElementById("nomorSekarang").innerHTML =
  "Sedang dipanggil: " + formatted;
}

// ðŸ”“ Logout
window.logout = function(){
  signOut(auth).then(()=>{
    window.location.href="login.html";
  });
}

</script>

</body>
</html>