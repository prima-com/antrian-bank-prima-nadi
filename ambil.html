<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ambil Nomor Antrian - Bank Prima Nadi</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
font-family:Arial;
background:#0b2d57;
color:white;
text-align:center;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
height:100vh;
margin:0;
}
h1{font-size:40px;margin-bottom:40px;}
button{
width:300px;
padding:25px;
margin:20px;
font-size:28px;
font-weight:bold;
border:none;
border-radius:20px;
cursor:pointer;
background:gold;
color:black;
box-shadow:0 5px 15px rgba(0,0,0,0.4);
}
button:hover{transform:scale(1.05);}
#hasil{
margin-top:40px;
font-size:70px;
color:gold;
font-weight:bold;
text-shadow:0 0 10px gold,0 0 20px rgba(255,215,0,0.8);
}
</style>
</head>
<body>

<h1>Silakan Ambil Nomor Antrian</h1>

<button onclick="ambilNomor('A')">Customer Service</button>
<button onclick="ambilNomor('B')">Teller</button>

<div id="hasil"></div>

<script>

var firebaseConfig = {
apiKey: "AIzaSyB7f2r5KbTkk-14bc5cXNHEVlV5J1WfMf8",
authDomain: "antrian-bank-prima-nadi.firebaseapp.com",
databaseURL: "https://antrian-bank-prima-nadi-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId: "antrian-bank-prima-nadi"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

function checkReset(){
const today=new Date().toISOString().slice(0,10);

db.ref("config/lastReset").once("value",snap=>{
if(snap.val()!==today){

db.ref("counter").set({A:1,B:1});
db.ref("queue").remove();
db.ref("stats").set({
totalWaiting:0,
totalToday:0,
totalCalled:0
});
db.ref("config/lastReset").set(today);

}
});
}

function ambilNomor(prefix){

checkReset();

db.ref("counter/"+prefix).transaction(function(current){
if(current===null) return 2;
return current+1;
},function(error,committed,snapshot){

if(committed){

let nomor = prefix + String(snapshot.val()-1).padStart(3,"0");

let dataAntrian={
nomor:nomor,
waktu:Date.now(),
status:"waiting"
};

db.ref("queue/"+prefix).push(dataAntrian);

db.ref("stats/totalWaiting").transaction(v=>(v||0)+1);
db.ref("stats/totalToday").transaction(v=>(v||0)+1);

document.getElementById("hasil").innerText=nomor;

setTimeout(()=>{
document.getElementById("hasil").innerText="";
},5000);

}

});
}

</script>
</body>
</html>


